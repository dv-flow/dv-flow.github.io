<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using Tasks &#8212; DV Flow  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Developing Tasks" href="tasks_developing.html" />
    <link rel="prev" title="Packages" href="packages.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="using-tasks">
<h1>Using Tasks<a class="headerlink" href="#using-tasks" title="Link to this heading">¶</a></h1>
<p>Tasks are the fundamental unit of behavior in a DV-Flow specification. Tasks
accept data from tasks that they depend on, and produce data to be used by
dependent tasks. Tasks may have local parameters to control operation.</p>
<p>The implementation of a task is required to perform three key tasks:</p>
<ul class="simple">
<li><p>Compute dependencies – Specifically, determine whether the task must
perform work. Tasks typically save a ‘memento’ with the system that
is used by future evaluations of the task.</p></li>
<li><p>Perform work – The task implementation must perform the desired
data transformation when required. Usually this involves invoking
another tool, such as a compiler. When work is performed, the task
may produce markers to communicate the location of errors, warnings,
or other key information.</p></li>
<li><p>Produce output – Tasks are required to pass data output data
to their successor tasks independent of whether the task performed
a data transformation.</p></li>
</ul>
<p>Most tasks are built on top of another existing task or tasks.These
‘derived’ tasks either modifiy the <cite>parameters</cite> of the base task
to cause it to behave as desired, or compose multiple tasks together
to achieve the desired functionality.</p>
<section id="specifying-the-base-task">
<h2>Specifying the Base Task<a class="headerlink" href="#specifying-the-base-task" title="Link to this heading">¶</a></h2>
<p>Each defined task has a unique identity. Typically, though, the required
behavior is very similar to that of an existing task. As a consequence,
it is very common to define a task in terms of another. This is
done via the <cite>uses</cite> clause.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PrintHello</span>
<span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.Message</span>
</pre></div>
</div>
<p>The example above creates a new task named <cite>PrintHello</cite> that
inherits the parameters and implementation of the existing
<cite>std.Message</cite> task.</p>
</section>
<section id="specializing-task-parameters">
<h2>Specializing Task Parameters<a class="headerlink" href="#specializing-task-parameters" title="Link to this heading">¶</a></h2>
<p>The simplest way to leverage existing tasks is to customize the
value of parameters that control the behavior of the base task.
Let’s take a look at the <cite>std.Message</cite> task. This task displays
a user-specified message string. By default, the message is empty.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PrintHello</span>
<span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.Message</span>
<span class="w">  </span><span class="nt">with</span><span class="p">:</span>
<span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Hello, World!</span>
</pre></div>
</div>
<p>The example above creates a new task named <cite>PrintHello</cite> that
overrides the value of the <cite>msg</cite> parameter. This causes
the implementation of <cite>std.Message</cite> to print ‘Hello, World!’.</p>
</section>
<section id="specifying-dependencies">
<h2>Specifying Dependencies<a class="headerlink" href="#specifying-dependencies" title="Link to this heading">¶</a></h2>
<p>Most tasks operate on data produced by other tasks. The <cite>needs</cite> clause
specifies the tasks that must complete before this task can execute.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rtlfiles</span>
<span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.FileSet</span>
<span class="w">  </span><span class="nt">with</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;verilogSource&quot;</span>
<span class="w">    </span><span class="nt">base</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;rtl&quot;</span>
<span class="w">    </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;*.v&quot;</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sim</span>
<span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hdlsim.vlt.SimImage</span>
<span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">rtlfiles</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">with</span><span class="p">:</span>
<span class="w">    </span><span class="nt">top</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mytop</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">run</span>
<span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hdlsim.vlt.SimRun</span>
<span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">sim</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>The example above shows three tasks that:</p>
<ul class="simple">
<li><p>Gather verilog source files from the <cite>rtl</cite> directory</p></li>
<li><p>Compile the files into a simulation image</p></li>
<li><p>Run the simulation image</p></li>
</ul>
<p>Data passes between each pair of steps above:</p>
<ul class="simple">
<li><p><cite>rtlfiles</cite> outputs a list of sources files required to create a simulation image</p></li>
<li><p>The sim-image task passes a path to the simulation image to the task that runs it</p></li>
</ul>
<p>In addition, one step cannot proceed until the proceeding step has completed. These
scheduling and dataflow requirements are captured using <cite>needs</cite> relationships.</p>
</section>
<section id="tasks-and-dataflow">
<h2>Tasks and Dataflow<a class="headerlink" href="#tasks-and-dataflow" title="Link to this heading">¶</a></h2>
<p>Task <cite>needs</cite> relationships specify dataflow between tasks in addition to
scheduling dependencies. A task provides two controls over what input
data is provided to the task implementation (if present) and what inputs
are forwarded to the output.</p>
<img alt="../_images/task_dataflow.excalidraw.svg" src="../_images/task_dataflow.excalidraw.svg" />
<p>The two controls are:</p>
<ul class="simple">
<li><p><strong>consumes</strong> - Specifies what input data will be passed to the implementation</p>
<ul>
<li><p><strong>all</strong> - All input data is passed to the implementation</p></li>
<li><p><strong>none</strong> - No input data is passed to the implementation</p></li>
<li><p><em>pattern</em> - Inputs matching a pattern are passed to the implementation</p></li>
</ul>
</li>
<li><p><strong>passthrough</strong> - Specifies what inputs are passed to the task output</p>
<ul>
<li><p><strong>all</strong> - All input data is passed to the output</p></li>
<li><p><strong>none</strong> - No input data is passed to the output</p></li>
<li><p><strong>unused</strong> - Inputs that are not consumed are passed to the output</p></li>
<li><p><em>pattern</em> - Inputs matching a pattern are passed to the output</p></li>
</ul>
</li>
</ul>
<p>The default value of <cite>passthrough</cite> is always <strong>unused</strong>. The default value for the
<cite>consumes`</cite> parameter depends on the task type:</p>
<ul class="simple">
<li><p><strong>Shell or Python Implementation</strong>: all</p></li>
<li><p><strong>DataItem or No Implementation</strong>: none</p></li>
</ul>
</section>
<section id="using-dataitem-tasks">
<h2>Using DataItem Tasks<a class="headerlink" href="#using-dataitem-tasks" title="Link to this heading">¶</a></h2>
<p>Tasks generally produce output data. That output data may be produced by the
task’s programming-language implementation (ie Python) when computation of
some form is required. When no computation is required, there is concise way
to produce a data item: define a task that <cite>uses</cite> a data type as the base.
This is most commonly done when producing a data item that captures a set
of tool options.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SimOptionsTrace</span>
<span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hdlsim.SimElabArgs</span>
<span class="w">  </span><span class="nt">with</span><span class="p">:</span>
<span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">--trace-fst</span><span class="p p-Indicator">]</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sim_img</span>
<span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hdlsim.vlt.SimImage</span>
<span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">SimOptionsTrace</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>The <cite>SimOptionsTrace</cite> task above will produce a single <cite>hdlsim.SimElabArgs</cite> data
item that instructs the <cite>Verilator</cite> simulator to enable dumping a FST-format
waveform file.</p>
<p>This has the same effect as adding <cite>–trace-fst</cite> directly on the <cite>sim_img</cite> task,
but provides more flexibility:</p>
<ul class="simple">
<li><p>Tasks can be defined with commonly-used sets of options</p></li>
<li><p>Conditional task execution can be used to select between option sets</p></li>
</ul>
</section>
<section id="using-compound-tasks">
<h2>Using Compound Tasks<a class="headerlink" href="#using-compound-tasks" title="Link to this heading">¶</a></h2>
<p>Compound tasks allow a task to be defined in terms of a set
of subtasks. In many cases, this allows more-advanced behavior
to be created without the need to provide a programming-language
implementation for the task.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CreateSVFiles</span>
<span class="w">  </span><span class="nt">rundir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inherit</span>
<span class="w">  </span><span class="nt">body</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mod1</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.CreateFile</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">filename</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mod1.sv</span>
<span class="w">        </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">module mod1;</span>
<span class="w">            </span><span class="no">endmodule</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mod2</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.CreateFile</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">filename</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mod2.sv</span>
<span class="w">        </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">module mod2;</span>
<span class="w">            </span><span class="no">endmodule</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">getFiles</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std.FileSet</span>
<span class="w">    </span><span class="nt">passthrough</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mod1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">mod2</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;verilogSource&quot;</span>
<span class="w">        </span><span class="nt">base</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;.&quot;</span>
<span class="w">        </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;*.sv&quot;</span>
</pre></div>
</div>
<p>The compound task above uses the <cite>std.CreateFile</cite> task to create
two SystmeVerilog files. We then want to pass both files on to
all tasks that depend on CreateSVFiles.</p>
<p>This is accomplished by:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Specifying that all tasks use the same run directory via the</dt><dd><p><cite>rundir: inherit</cite> clause.</p>
</dd>
</dl>
</li>
<li><p>Causing the <cite>getFiles</cite> to depend on the file-creation tasks</p></li>
</ul>
</section>
<section id="conditional-tasks">
<h2>Conditional Tasks<a class="headerlink" href="#conditional-tasks" title="Link to this heading">¶</a></h2>
<p>By default, all tasks on the <cite>needs</cite> dependency path from the root task(s) will be
executed. In some cases, though, it is desirable to only execute tasks under specific
circumstances. The <cite>iff</cite> property of  tasks supports this use model.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">package</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_ip</span>
<span class="w">  </span><span class="nt">with</span><span class="p">:</span>
<span class="w">    </span><span class="nt">debug_level</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SimOptions</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hdlsim.SimElabArgs</span>
<span class="w">    </span><span class="nt">body</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SimOptionsDebug</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hdlsim.SimElabArgs</span>
<span class="w">      </span><span class="nt">iff</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ debug_level &gt; 0 }}</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">--trace-fst</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sim_img</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hdlsim.vlt.SimImage</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">SimOptions</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>The example above uses conditional execution to customize elaboration options.
When the <cite>debug_level</cite> parameter’s value is greater than 0, the <cite>SimOptionsDebug</cite> task
sends the <cite>–trace-fst</cite> option to the simulator. Otherwise, no additional arguments are
provided.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">DV Flow</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Flow-Spec Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://dv-flow.github.io/dv-flow-mgr">DV Flow Manager</a></li>
<li class="toctree-l1"><a class="reference external" href="https://dv-flow.github.io/pytest-dfm">pytest Extension</a></li>
<li class="toctree-l1"><a class="reference external" href="https://dv-flow.github.io/vscode-dv-flow">VSCode Extension</a></li>
<li class="toctree-l1"><a class="reference external" href="https://dv-flow.github.io/dv-flow-libcc">C/C++ Library</a></li>
<li class="toctree-l1"><a class="reference external" href="https://dv-flow.github.io/dv-flow-libhdlsim">HDLSim Library</a></li>
<li class="toctree-l1"><a class="reference external" href="https://dv-flow.github.io/dv-flow-libide">IDE Library</a></li>
<li class="toctree-l1"><a class="reference external" href="https://dv-flow.github.io/dv-flow-libpss">PSS Library</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">User Guide</a><ul>
      <li>Previous: <a href="packages.html" title="previous chapter">Packages</a></li>
      <li>Next: <a href="tasks_developing.html" title="next chapter">Developing Tasks</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2023-2025, Matthew Ballance.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/userguide/tasks_using.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>